## 混沌工程
### 背景
> 随着微服务和云原生架构的普及、成熟，越来越多的公司开始使用微服务架构来解耦应用，提高业务的迭代发布速度，实现业务价值。微服务架构可以提高开发灵活性和部署速度，但本质上是混乱的。随着规模越来越大，系统也变得越来越复杂，且众所周知，故障总是发生在意料之外，情理之中，没有一个系统能够保证 100% 的持续正常运行，这是我们需要学会接受的事实，虽然可以使用一些技术对故障进行降级，使用冗余部署实现架构高可用容错。但在复杂系统中，从不同微服务之间的交互到现实世界的破坏性事件，不可预测的结果随时笼罩着生产环境。 探索复杂系统未知问题的手段之一就是开展混沌工程，混沌工程是一门新兴的技术学科，他的初衷是通过实验性的方法，让工程师建立应对复杂系统中未知问题的信心。

### 目的
> 提倡使用一系列实验来真实地验证系统在各类故障场景下的表现，通过频繁地进行大量实验，使得系统本身的反脆弱性持续增强。每一次故障中的获益，让系统不断进化，形成正向循环，逐步提高系统的质量，保证系统的健壮性。当混沌工程成为常态化的系统稳定性的保障手段后，系统的整体稳定性将得到进一步提升。通过混沌工程平台，主动向系统注入故障，验证和评估系统抵抗故障并保持正常运行的能力，提前识别未知的缺陷并进行修复，保障系统更好得抵御生产环境中的失控条件，有效提升系统的整体稳定性。

### 支持故障注入类型
#### 基础资源类故障场景
| 混沌场景 | 目的 |实现原理|
| ------ | ------ | ------ |
| CPU 高负载 | 关注对业务处理吞吐率的影响 |消耗 CPU 时间片|
| 内存占用 | 模拟内存占用高的场景 |采用代码申请内存实现|
|磁盘 IO 高负载|评估对磁盘读写敏感的业务的影响|使用 dd 命令实现|
|磁盘填充|主要验证如日志目录打满对服务的影响|使用 fallocate、dd 命令实现|
|网络延迟|评估业务对网络延迟的容忍程度，评估超时、重试机制设置是否合理，防止级联事故|使用 tc 命令实现|
|网络丢包|评估业务对网络丢包的容忍程度|使用 tc 命令实现|
|进程假死|观测负载均衡时效性、业务敏感性|kill -STOP {pids}|
|进程终止|观测负载均衡时效性、业务敏感性（Nginx&Tomcat）|kill -9 {pids}|
#### JAVA 进程故障和中间件依赖故障场景
| 类型 | 混沌场景 |目的|
| ------ | ------ |------ |
| JAVA 进程故障 | 进程 CPU 满载 |评估服务节点 CPU 满载时对服务的影响 |
| 内存溢出 | 评估 GC 对服务的影响 | |
| 接口延迟 | 评估接口故障对服务的影响 | |
| 接口抛异常 |评估接口故障对服务的影响  | |
| 接口返回值篡改 | 评估针对非预期接口返回的处理 | |
| 线程池打满 | 评估线程池打满对服务的影响| |
| 中间件依赖故障 | 请求延迟 | 评估中间件故障对自身的影响|
| 数据库请求延迟 | 评估中间件故障对自身的影响 | |
| MYSQL 请求抛异常 | 评估中间件故障对自身的影响 | |

### 混沌工程工具
| 工具名称 | 开源机构|最新版本 |核心语言|包含场景|特定依赖|
| ------ | ------ |------ |------ |------ |------ |
| ChaosBlade | 阿里 |1.7.2|go|实验框架，支持系统资源、网络、应用层面等多种故障的注入|无|
| ChaosMesh | - |2.6.1|go|实验框架，支持系统资源、网络、应用层面等多种故障的注入|依赖于 K8s 集群|
| ChaosToolkit | - |1.15.1|python|实验框架，可集成多个 IaaS 或 PaaS 平 台，可使用多个故障注入工具定制场景,可与多个监控平台合作观测和记录指标信息|通过插件形式支持多个 IaaS、PaaS，包括 AWS/Azure/Goog le/K8s|
| orchestrator | openark |3.2.6|go|纯 MySQL 集群故障场景|无|
| powerfulseal | - |3.3.0|python|终止 K8s、Pods，终止容器，终止虚拟机|支持 OpenStack/AWS/ 本地机器|
| toxiproxy | - |2.5.0|go|网络代理故障，网络故障|无|

### 参考文档
* [主动发现系统稳定性缺陷：混沌工程](https://my.oschina.net/u/4090830/blog/9874387)
* [混沌工程在 Netflix 的演进](https://aws.amazon.com/cn/blogs/china/the-evolution-of-chaos-engineering-at-netflix/)
* [混沌工程(Chaos Engineering) 到底是什么](https://cloud.tencent.com/developer/article/1622874)
