## 数据管理系统的查询优化
> 数据库管理系统（DataBase Management System，DBMS，简称数据库）是位于用户与操作系统之间的一层数据管理软件，主要功能包括：数据定义、数据操纵、数据库的运行管理、数据库的建立和维护

### 查询优化
> 对查询语句进行优化的技术就是查询优化技术，运用查询技术实现数据操纵功能的过程是确定给定查询的高效执行计划的过程
#### 执行计划
> 所谓执行计划就是查询树，它由一系列内部的操作符组成，这些操作符按一定的运算关系构成查询的一个执行方案。查询优化的追求目标，就是在数据库查询优化引擎生成一个执行策略的过程中，尽量使查询的总开销（总开销通常包括IO、CPU、网络传输等）达到最小
#### 数据库查询优化技术
* 查询重用技术
* 查询重写规则
* 查询算法优化技术
* 并行查询优化技术
* 分布式查询优化技术
* 其他方面（如框架结构）的优化技术

### 数据库调优
* 人工调优。主要依赖于人，效率低下；要求操作者完全理解常识所依赖的原理，还需要对应用、数据库管理系统、操作系统以及硬件有广泛而深刻的理解
* 基于案例的调优。总结典型应用案例情况中数据库参数的推荐配置值、数据逻辑层设计等情况，从而为用户的调优工作提供一定的参考和借鉴。但这种方式忽略了系统的动态性和不同系统间存在的差异
* 自调优。为数据库系统建立一个模型，根据“影响数据库系统性能效率的因素”，数据库系统自动进行参数的配置
#### Oracle数据库调优工具
* Redo Logfile Sizing Advisor：为避免因频繁出现的检查点而导致过多的磁盘IO，系统可推荐重做日志文件的最佳大小
* Automatic Checkpoint Tuning：为取得良好的恢复速度，同时降低对正常吞吐量的影响，系统可以自动优检查点
* Automatic Shared Memory Tuning：为高效地利用可用内存并提高性能，系统可自动地配置与System Global Area（SGA）内存相关的参数（如缓冲区缓存、共享池等）
* Transaction Rollback and Recovery Monitoring：为掌握事务状况，系统可估计回滚一个事务要花多少时间，监视被恢复的事务的进度，并估计事务恢复的平均速度
* SQL Tuning Advisor：为提高SQL语句的执行效率，系统可自动调优高成本的SQL语句，给出建立索引的建议、SQL重写的建议等
* SQL Analyzer：对SQL语句的不同查询执行计划进行性能分析和比较
* SQL Access Advisor：对物理设计给出改进建议
* SQL Plan Management：使SQL语句能够根据环境的变化选择稳定、高效的查询执行计划
* Segment Advisor：根据对象内的空间碎片化程度，给出是否应该对对象执行新的在线收缩操作的建议；提供关于段的历史增长趋势的报告，为容量规划提供有效的信息
#### 调优涉及的技术
* 应用情况的估算。应用的使用方式（把业务逻辑转换为数据库的读写分布逻辑，以读多写少或读写均衡等来区分OLAP和OLTP；应用对数据库的并发情况、并发是否可以池化等）、数据量、对数据库的压力、峰值压力等做一个预估
* 系统选型策略。确定什么样的数据库可以适用应用需求，并确定使用开源的数据库还是商业的数据库，使用集群还是单机的系统，同时对操作系统、中间件、硬件、网络等进行选型
* 数据模型的设计。主要根据业务逻辑，从几个角度考虑表的逻辑结构，内容如下
  * E-R模型设计：遵循E-R模型设计原理。偶尔的、适当程度的非规范化可以改善系统查询性能
  * 数据逻辑分布策略：目的是减少数据请求中不必要的数据量，只返回用户需要的数据。可用的技术如分区、用E-R模型分表等（如互联网企业典型的用法，根据业务的不同，进行分库、分表等操作）
  * 数据物理存储策略：目的是减少IO操作，如启用压缩技术、把索引和表数据的存储分开，不同的表数据分布在不同的表空间上，不同的表空间分布在不同的物理存储上（尤其是读写量大的表空间分布在不同的物理存储上），日志、索引和数据分布在不同的物理存储上等
  * 索引：在查询频繁的对象上建立恰当的索引，使索引的正效应大于负效应（索引的维护存在消耗）
* SQL设计。编写正确的、查询效率高的SQL语句，依据的主要是“查询重写规则”。编写语句的过程中要注意，要有意识地保障SQL能利用到索引
* 数据库功能的启用。数据库为提高性能提供了一些功能，可合理使用，具体如下
  * 查询重用：根据实际情况进行配置，可缓存查询执行计划、查询结果等
  * 数据库参数的设置：可设置合适的参数，如数据缓冲区等
* 模型系统预运行。在备用系统上模拟实际运行环境，加大压力进行系统测试，提前发现问题
* 系统监控与分析。在工业环境下，加强对系统的运行监控和日常的分析工作，具体如下
  * 应用系统表现：收集用户对应用系统的使用意见、系统存在问题等，因为这些可能是用户在第一时间发现的
  * OS环境监控：实时监控CPU、内存、IO等，并对比实时情况与历史正常情况
  * 数据库内部状况监控：一些数据库提供系统表、视图、工具等手段，向用户提供数据库运行过程中内部状况的信息，如锁的情况，这些都需要实时监控，并对比实时情况与历史正常情况
  * 日志分析：在数据库的日志、操作系统的日志中找出异常事件，定位问题
