## PostgreSQL查询优化器概述
> PostgreSQL查询优化器主要的功能是完成SELECT语句的执行，在保证SELECT语句正确执行之外，还有一个重要的功能，就是使用关系代数、启发式规则、代价估算模型等不同种类的技术，提高SELECT语句执行的效率
### PostgreSQL查询执行过程
1. 语法分析阶段。将SQL查询语句经词法分析和语法分析后变换为一棵查询树（Query Tree）传给下一个阶段
2. 语义检查阶段。对SQL表达的语义进行检查
3. 查询优化阶段。对语法分析树进行优化，主要分为以下两个子阶段
   * 视图重写：在查询重写规则模块中对视图用基表进行重写
   * 集合分解为非集合操作：把集合操作分解为非集合操作。对于非集合操作，又分为SPJ优化和非SPJ优化两个子阶
     * SPJ优化
        * 生成逻辑查询执行计划阶段。优化器在查询树中查找关系，创建关系结点RelOptInfo，运用查询优化技术，如子查询优化、条件化简、等价谓词重写、外连接消除等，对查询树进行等价转换，得到逻辑查询执行计划
        * 生成物理查询执行计划阶段。优化器对RelOptInfo的各个连接对象计算代价，对存取关系的不同方法、以及对所有连接对的不同连接方法创建不同路径结点，找出代价最小的路径后创建相应的计划结点，放在RelOptInfo的pathlist字段中
     * 非SPJ优化主要是对分组、排序、聚集、去重等操作的优化
4. 查询计划执行阶段。按照传到执行器的查询执行计划进行执行
   
   ![image](https://github.com/jsjchai/study-notes/assets/13389058/ac9dd8eb-d432-4507-9bb2-eb4405e527ec)
