## 查询优化器与其他模块的关系
> 在数据库内部，根据功能不同，可以划分出多个模块，不同模块之间有的关系紧密，有的关系松散。查询优化器是其中的一个功能模块，是实现查询优化技术的模块
### 查询优化器整体介绍
1. SQL输入
   * 数据库接受用户输入的SQL语句，准备执行
2. 语法分析
   * 对输入的SQL语句进行词法分析、语法分析，得到语法分析树
3. 语义检查
   * 根据语法树和系统的元信息进行语义检查，本阶段是对语法分析树进行逻辑判断，树的结构不发生变化。对语法分析树上的各个结点进行语义分析，判断对象是否存在、是否重名等；对不合语义的报告错误
4. SQL优化
   * SQL优化通常包括两项工作：一是逻辑优化，二是物理优化。这两项工作都要对语法分析树的形态做修改，把语法分析树变为查询树。其中，逻辑查询优化将生成逻辑查询执行计划。在生成逻辑查询执行计划的过程中，根据关系代数的原理，把语法分析树变为关系代数语法树的样式，原先SQL语义中的一些谓词变化为逻辑代数的操作符等样式，这些样式是一个临时的中间状态，经过进一步的逻辑查询优化，如执行常量传递、选择下推等（逻辑优化过程的样式，对树的结构做调整，如一些结点下移、一些结点上移），从而生成逻辑查询执行计划

   * 在生成逻辑查询计划后，查询优化器会进一步对查询树进行物理查询优化。物理优化会对逻辑查询计划进行改造，改造的内容主要是对连接的顺序进行调整。SQL语句确定的连接顺序经过多表连接算法的处理，可能导致表之间的连接顺序发生变化，所以树的形态有可能调整
5. SQL执行
   * 在SQL执行阶段，依据物理查询计划执行查询，逐步调用相关算法进行执行
### 查询优化器与其他模块的关系
1. 查询优化器与语法分析器
   * 语法分析器是查询优化器的前端部分，语法分析器的输出是查询优化器的输入
2. 优化器与执行器
   * 查询优化器是执行器的前端部分，查询优化器的输出是执行器的输入
3. 优化器与缓冲区
   * 缓冲区有多种多样，比如与数据相关的缓冲区（如从存储设备加载数据到内存）、与实现过程相关的辅助缓冲区（如排序用到的临时表或内存块）、与功能模块相关的缓冲区（如日志缓冲区）等
   * 优化器主要是对SQL输入进行逻辑方式的变换，没有涉及数据部分，只涉及对数据量的估计。当估算排序空间的时候，会涉及排序缓冲区；当估算数据IO的时候，需要考虑数据是否在数据缓存中
4. 优化器与对象访问
   * 对象访问可分为两个层面，一是对元信息的获取，二是对于数据的获取。元信息通常被调入内存多次使用，故一次调入多次使用对性能影响不大。数据可能面临着反复多次被调入调出。优化器基于一些统计数据进行花费比较，使用的多是元信息
5. 优化器与统计
   * 多数数据库的查询优化器使用了基于代价的查询执行计划估算，所以依赖于被查询对象的各种数据，而数据是动态变化的，如表的元组数。如果实时获得这些数据，系统计算的开销会比较大。为了避免这样的问题，定期或根据需要统计这些数据，则比较切合实际。所以多数数据库系统都有统计模块存在
   * 优化器在物理优化阶段，需要对单表读取花费、两表连接花费、多表连接顺序花费等进行比较，比较基于的就是一些基础数据的值，这些数据值通常不会被实时更新，所以优化器有时做出的计划未必是最合适的
6. 优化器与索引
   * 优化器做物理查询优化需要利用索引提高单表扫描效率，进而减少了多表连接时的元组数，所以确定哪些索引可用、怎么有效利用索引等都在查询优化器中得到了体现
